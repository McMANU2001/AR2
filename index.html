<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Eduardo Avaroa - Experiencia Interactiva Accesible</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            font-family: Arial, sans-serif;
        }
        #fullscreen-btn, #audio-controls {
            position: fixed;
            right: 10px;
            padding: 10px;
            background: #333;
            color: #fff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            z-index: 999;
        }
        #fullscreen-btn {
            top: 10px;
        }
        #audio-controls {
            top: 60px;
        }
        #accessibility-info {
            position: fixed;
            bottom: 10px;
            left: 10px;
            color: white;
            background: rgba(0,0,0,0.7);
            padding: 10px;
            border-radius: 5px;
            display: none;
        }
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0,0,0,0);
            white-space: nowrap;
            border: 0;
        }
    </style>
</head>
<body>
    <a-scene 
        embedded 
        arjs="trackingMethod: best; sourceType: webcam; debugUIEnabled: true; detectionMode: mono_and_matrix; matrixCodeType: 3x3;"
        vr-mode-ui="enabled: false"
        renderer="antialias: true; colorManagement: true; sortObjects: true;"
        id="ar-scene"
        role="application"
        aria-label="Experiencia de Realidad Aumentada de Eduardo Avaroa">
        
        <a-assets>
            <audio id="sound" src="avaroaTExto.mp3" preload="auto">
                <track kind="captions" src="avaroa-captions.vtt" srclang="es" label="Subtítulos en Español">
            </audio>
        </a-assets>

        <a-marker type="pattern" url="avaroa_marker.patt">
            <a-entity position="0 0 1.3" rotation="0 0 0">
                <a-entity 
                    gltf-model="url(avaroa.gltf)" 
                    scale="0.8 0.8 0.8"  
                    position="0 0 0"
                    rotation="-100 0 0"
                    animation-mixer
                    shadow="receive: true; cast: true"
                    aria-label="Modelo 3D de Eduardo Avaroa"
                    role="img">
                </a-entity>

                <a-image 
                    src="avaroaImagen.jpg"
                    position="-2.3 0 -2" 
                    rotation="-100 0 0"
                    width="2.5"
                    height="2.6"
                    alt="Retrato histórico de Eduardo Avaroa"
                    aria-description="Fotografía de Eduardo Avaroa, líder militar y político boliviano">
                </a-image>

                <a-image 
                    src="TextoAvaroa.png"
                    position="2.3 0 -2" 
                    rotation="-100 0 0"
                    width="2.5"
                    height="2.6"
                    alt="Texto informativo sobre Eduardo Avaroa"
                    aria-description="Información textual sobre la vida y obra de Eduardo Avaroa">
                </a-image>

                <a-entity sound="src: #sound"></a-entity>
            </a-entity>
        </a-marker>

        <a-entity camera aria-label="Cámara de realidad aumentada"></a-entity>
    </a-scene>

    <div id="accessibility-info" aria-live="polite">
        Información de accesibilidad: Experiencia interactiva lista
    </div>

    <button id="fullscreen-btn" aria-label="Alternar pantalla completa">Pantalla Completa</button>
    <button id="audio-controls" aria-label="Control de audio">
        <span id="audio-status">Reproducir Audio</span>
    </button>

    <div id="keyboard-instructions" class="sr-only">
        Instrucciones de teclado:
        - Enter/Espacio: Iniciar/Pausar contenido
        - F: Alternar pantalla completa
    </div>

    <script>
        const marker = document.querySelector('a-marker');
        const model = document.querySelector('[gltf-model]');
        const sound = document.querySelector('[sound]');
        const fullscreenBtn = document.getElementById('fullscreen-btn');
        const audioControls = document.getElementById('audio-controls');
        const audioStatus = document.getElementById('audio-status');
        const accessibilityInfo = document.getElementById('accessibility-info');

        let isAudioPlaying = false;

        marker.addEventListener('markerFound', () => {
            console.log('Marcador encontrado');
            model.setAttribute('animation-mixer', 'timeScale: 1');
            accessibilityInfo.textContent = 'Marcador detectado. Contenido activado.';
            accessibilityInfo.style.display = 'block';
        });

        marker.addEventListener('markerLost', () => {
            console.log('Marcador perdido');
            model.setAttribute('animation-mixer', 'timeScale: 0');
            sound.components.sound.pauseSound();
            accessibilityInfo.textContent = 'Marcador perdido. Contenido pausado.';
        });

        function toggleFullScreen() {
            if (!document.fullscreenElement) {
                if (document.documentElement.requestFullscreen) {
                    document.documentElement.requestFullscreen();
                } else if (document.documentElement.mozRequestFullScreen) {
                    document.documentElement.mozRequestFullScreen();
                } else if (document.documentElement.webkitRequestFullscreen) {
                    document.documentElement.webkitRequestFullscreen();
                }
            } else {
                if (document.exitFullscreen) document.exitFullscreen();
                else if (document.mozCancelFullScreen) document.mozCancelFullScreen();
                else if (document.webkitExitFullscreen) document.webkitExitFullscreen();
            }
        }

        function toggleAudio() {
            if (!isAudioPlaying) {
                sound.components.sound.playSound();
                audioStatus.textContent = 'Pausar Audio';
                isAudioPlaying = true;
            } else {
                sound.components.sound.pauseSound();
                audioStatus.textContent = 'Reproducir Audio';
                isAudioPlaying = false;
            }
        }

        function handleKeyboardNavigation(event) {
            switch(event.key) {
                case 'Enter':
                case ' ':
                    toggleAudio();
                    break;
                case 'f':
                case 'F':
                    toggleFullScreen();
                    break;
            }
        }

        fullscreenBtn.addEventListener('click', toggleFullScreen);
        audioControls.addEventListener('click', toggleAudio);
        document.addEventListener('keydown', handleKeyboardNavigation);
    </script>
</body>
</html>